# MPL â€“ Stage 2J (Session Persistence & Experiment Logs)

This is the **complete Stage 2J project** with all modules from Stage 2A through 2J integrated in one place.

---

## Directory Tree

```
MPL-Stage-2/
â”œâ”€ package.json
â”œâ”€ tsconfig.json
â”œâ”€ README.md
â”œâ”€ src/
â”‚  â”œâ”€ runtime/
â”‚  â”‚  â”œâ”€ interpreter.ts       # Core MPL interpreter
â”‚  â”‚  â”œâ”€ monad.ts             # Monad definition
â”‚  â”‚  â”œâ”€ grid.ts              # Grid engine with cell state
â”‚  â”‚  â””â”€ topology/
â”‚  â”‚     â””â”€ index.ts          # Toroidal / clipping edges
â”‚  â”œâ”€ debug/
â”‚  â”‚  â””â”€ trace.ts             # Debugger + error reporter
â”‚  â”œâ”€ emotional/
â”‚  â”‚  â””â”€ types.ts             # Affect/joy/adequacy types
â”‚  â”œâ”€ utils/
â”‚  â”‚  â””â”€ io.ts                # IO utilities
â”‚  â””â”€ web/
â”‚     â”œâ”€ web-main.ts          # Browser entrypoint
â”‚     â”œâ”€ colors.ts            # Heatmap & visualization colors
â”‚     â””â”€ session.ts           # Session persistence + logs
â””â”€ examples/
   â””â”€ run.ts                  # Node CLI runner
```

---

## README.md (excerpt)

```md
# MPL â€“ Stage 2J (Session Persistence & Experiment Logs)

## Features up to Stage 2J
- âœ… 2A: Rule engine with snapshot reads + staged writes.
- âœ… 2B: Neighbor-aware env + Grid2D with topologies.
- âœ… 2C: Debugger with trace events.
- âœ… 2D: Error reporter patch.
- âœ… 2E: Visualization (ASCII, PNG).
- âœ… 2F: PNG snapshot renderer.
- âœ… 2G: Browser live visualization.
- âœ… 2H: Toroidal edges + affect heatmap.
- âœ… 2I: Rule authoring UI + presets.
- âœ… 2J: Session persistence + experiment logs.
```

---

## Key Code Highlights

### session.ts

```ts
export class SessionManager {
  constructor(private key: string = 'mpl-sessions') {}

  saveSession(name: string, state: any) {
    const sessions = this.loadAll();
    sessions[name] = state;
    localStorage.setItem(this.key, JSON.stringify(sessions));
  }

  loadSession(name: string) {
    const sessions = this.loadAll();
    return sessions[name] ?? null;
  }

  deleteSession(name: string) {
    const sessions = this.loadAll();
    delete sessions[name];
    localStorage.setItem(this.key, JSON.stringify(sessions));
  }

  loadAll() {
    try {
      return JSON.parse(localStorage.getItem(this.key) || '{}');
    } catch {
      return {};
    }
  }
}
```

### web-main.ts (excerpt)

```ts
import { SessionManager } from './session';

const sessionManager = new SessionManager();

// Hook into UI buttons
document.getElementById('saveBtn')?.addEventListener('click', () => {
  const state = collectCurrentState();
  const name = prompt('Session name?') || `sess-${Date.now()}`;
  sessionManager.saveSession(name, state);
});

document.getElementById('loadBtn')?.addEventListener('click', () => {
  const name = prompt('Session to load?');
  if (name) {
    const state = sessionManager.loadSession(name);
    if (state) applyState(state);
  }
});
```

---

ðŸ“Œ Stage 2J ensures experiments are **never lost** between reloads, supports named sessions, and allows users to **log and review experiments** over time. This is now the full integrated canvas for Stage 2J.
